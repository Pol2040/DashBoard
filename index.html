<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard RRSS ObSBA</title>

  <!-- Google Charts -->
  <script src="https://www.gstatic.com/charts/loader.js"></script>

<style>
/* ================= ESTILO GENERAL ================= */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #e9ecef;
  margin: 0;
  padding: 30px;
  color: #343a40;
}

.dashboard-container {
  max-width: 1400px;
  margin: auto;
  background: #ffffff;
  padding: 40px;
  border-radius: 15px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

h1 {
  color: #4e73df;
  border-bottom: 3px solid #4e73df;
  padding-bottom: 15px;
  margin-bottom: 20px;
  text-align: center;
}

/* ================= CONTROLES ================= */
.controls {
  display: flex;
  gap: 24px;
  justify-content: center;
  align-items: center;
  margin-bottom: 20px;
  padding: 16px;
  background: #f8f9fa;
  border-radius: 10px;
}

.controls label {
  font-weight: 700;
  color: #6c757d;
  margin-right: 8px;
}

.controls select {
  padding: 10px 14px;
  border: 2px solid #ced4da;
  border-radius: 8px;
  background: #fff;
  min-width: 260px;
  font-size: 1rem;
}

.controls select:focus {
  border-color: #4e73df;
  box-shadow: 0 0 0 0.2rem rgba(78,115,223,0.15);
  outline: none;
}

/* ================= CARD CONTENEDOR ================= */
.chart-card {
  background: #fff;
  border: 1px solid #e3e6f0;
  border-radius: 12px;
  padding: 24px;
  margin-top: 20px;
  box-shadow: 0 0 15px rgba(0,0,0,0.05);
}

.card-title {
  text-align: center;
  color: #4e73df;
  font-weight: 700;
  font-size: 1.3rem;
  margin-bottom: 12px;
}

#chart_area {
  width: 100%;
  min-height: 520px;
}

.info {
  text-align: center;
  color: #e74a3b;
  margin-top: 12px;
}

.footer-note {
  font-size: 0.9rem;
  color: #6c757d;
  text-align: center;
  margin-top: 12px;
}

/* ================= TARJETAS AUXILIARES ================= */

.aux-card {
  width: 200px;          /* üîΩ m√°s chica */
  padding: 16px 18px;    /* üîΩ menos padding */
  border-radius: 14px;
}

.aux-row {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 6px; 
}

/* Texto chico (PL, etc) */
.aux-label {
  font-size: 0.95rem;
  font-weight: 700;
  color: #4e73df;
  text-transform: uppercase;
}

/* N√∫mero grande */
.aux-value {
  font-size: 1.8rem;
  font-weight: 900;
  color: #111827;
}

#auxCardsContainer {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 16px;
  width: 100%;
  padding: 0 12px;
}

#auxCardsContainer .card {
  width: 100%; 
}



/* ================= GRID DE TARJETAS ================= */
.card-grid {
  display: flex;
  gap: 24px;
  justify-content: center;
  flex-wrap: wrap;
  padding: 24px 0;
}

/* ================= TARJETAS ================= */
.card {
  background: #ffffff;
  width: 300px;
  border-radius: 16px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.12);
  padding: 22px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  position: relative;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 14px 32px rgba(0,0,0,0.15);
}

.card-top {
  border-top: 6px solid #4e73df;
}

/* ================= CONTENIDO TARJETA ================= */
.card-rank {
  font-weight: 800;
  color: #4e73df;
  font-size: 1.1rem;
}

.card-main {
  font-size: 2.2rem;
  font-weight: 900;
  color: #111827;
}

.card-stats {
  font-size: 0.95rem;
  color: #374151;
  line-height: 1.5;
}

.card-link {
  margin-top: auto;
  font-weight: 700;
  color: #4e73df;
  text-decoration: none;
}

.card-link:hover {
  text-decoration: underline;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {

  /* Contenedor del label */
  .grafico-label,
  label {
    display: block;
    width: 100%;
    white-space: normal;     /* permite salto de l√≠nea */
    word-break: break-word;  /* corta si es necesario */
    text-align: left;
  }

}
@media (max-width: 768px) { /* tablets */
    .controls {
    flex-direction: column;
  }
  .aux-value {
    font-size: 1.5rem;
  }

  .aux-label {
    font-size: 0.7rem;
  }
}

@media (max-width: 480px) { /* celulares */
    .controls {
    flex-direction: column;
  }
  .aux-value {
    font-size: 1.3rem;
  }

  .aux-label {
    font-size: 0.65rem;
  }

  .aux-card {
    padding: 12px 14px;
  }
}

</style>
</head>
<body>

  <div class="dashboard-container">
  <h1>Dashboard RRSS ObSBA</h1>

    <div class="controls">
      <div>
        <label for="socialSelect">Red social:</label><br/>
        <select id="socialSelect"></select>
      </div>

      <div>
        <label for="chartSelect">Gr√°fico:</label><br/>
        <select id="chartSelect"></select>
      </div>
    </div>

<div class="chart-card">
  <div class="card-title" id="cardTitle">Seleccione una red y un gr√°fico</div>
  <div id="chart_area">Cargando...</div>
  <div id="auxCardsContainer" class="card-grid"></div>
  <div id="chartInfo" class="info"></div>
</div>


<script>
/* ========== CONFIG: GIDs y mapeo de gr√°ficos (basado en tu input) ========== */
const SHEET_ID = '17nld9mh3PtcOSPkKU2VxFGIkUD3w8IaZ1VyuR2XhtN8';

const SHEETS = {
  "General": { gid: "936287352", label: "HomePage" },
  "Instagram": { gid: "2147310482", label: "Instagram" },
  "Facebook": { gid: "708910305", label: "Facebook" },
  "X": { gid: "1309548050", label: "X" },
  "TikTok": { gid: "650301486", label: "TikTok" },
  "YouTube": { gid: "398717676", label: "YouTube" }
};
const CHARTS_BY_SHEET = {
"General": {
  "promedios": {
    label: "Promedios generales",
    query: `
      SELECT A, B, C, D
      WHERE A IS NOT NULL
        AND (B IS NOT NULL OR C IS NOT NULL OR D IS NOT NULL)
      LABEL A "A√±o"
    `,
    chartType: 'ColumnChart'
  }
},


  "Instagram": {
"anual": {
  label: "Tasa de compromiso total",
  query: `
    SELECT A, B, C, D, E, F, G, H
    WHERE A IS NOT NULL
      AND (B IS NOT NULL OR C IS NOT NULL OR D IS NOT NULL)
    LABEL
      A "A√±o",
      B "Serie 1",
      C "Serie 2",
      D "Serie 3",
      E "Media Interacciones",
      F "Media Likes",
      G "Media Comentarios",
      H "Media Visualizaciones"
  `,
  chartType: 'ColumnChart',
  chartColumns: [0, 1, 2, 3], // A‚ÄìD ‚Üí gr√°fico
  auxColumns: [4, 5, 6, 7]    // E‚ÄìF‚ÄìG‚ÄìH ‚Üí tarjetas auxiliares
},


"bimestral": {
  label: "Tasa de compromiso por bimestres",
  query: `
    SELECT M, N, O, P, Q, R, S
    WHERE M IS NOT NULL
      AND (N IS NOT NULL OR O IS NOT NULL OR P IS NOT NULL OR Q IS NOT NULL OR R IS NOT NULL OR S IS NOT NULL)
    LABEL M "A√±o"
  `,
  chartType: 'ColumnChart'
},
   "tipo_post": {
  label: "Anual. Por tipo de publicaci√≥n",
  query: `
    SELECT J, K, L
    WHERE J IS NOT NULL
      AND (K IS NOT NULL OR L IS NOT NULL)
    LABEL J "A√±o"
  `,
  chartType: 'ColumnChart'
},

 "Top_Anual": {
  label: "Top publicaciones anuales",
  query: `
    SELECT U, V, W, X, Y, AA
    WHERE U IS NOT NULL
      AND (V IS NOT NULL OR W IS NOT NULL OR X IS NOT NULL OR Y IS NOT NULL OR AA IS NOT NULL)
    LABEL U "Top"
  `,
  chartType: 'Card',
  cardTemplate: 'topAnual'
},
 "Top_Bimestral": {
  label: "Top publicaciones Bimestrales",
  query: `
    SELECT AB, AC, AE, AF, AH, AI, AK
    WHERE AB IS NOT NULL
      AND (AC IS NOT NULL OR AE IS NOT NULL OR AF IS NOT NULL OR AH IS NOT NULL OR AI IS NOT NULL OR AK IS NOT NULL)
    LABEL AB "Bimestre"
  `,
  chartType: 'Card',
  cardTemplate: 'topBimestral'
}
  },

  "Facebook": {
  "anual": {
  label: "Tasa de compromiso total",
  query: `
    SELECT A, B, C, D, E, F, G, H
    WHERE A IS NOT NULL
      AND (B IS NOT NULL OR C IS NOT NULL OR D IS NOT NULL)
    LABEL
      A "A√±o",
      B "Serie 1",
      C "Serie 2",
      D "Serie 3",
      E "Media Interacciones",
      F "Media Likes",
      G "Media Comentarios",
      H "Media Visualizaciones"
  `,
  chartType: 'ColumnChart',
  chartColumns: [0, 1, 2, 3], // A‚ÄìD ‚Üí gr√°fico
  auxColumns: [4, 5, 6, 7]    // E‚ÄìF‚ÄìG‚ÄìH ‚Üí tarjetas auxiliares
},
  "bimestral": { 
  label: "Tasa de compromiso por bimestres.",
  query: `
    SELECT M, N, O, P, Q, R, S
    WHERE M IS NOT NULL
      AND (N IS NOT NULL OR O IS NOT NULL OR P IS NOT NULL OR Q IS NOT NULL OR R IS NOT NULL OR S IS NOT NULL)
    LABEL M 'Bimestre'
  `,
  chartType: 'ColumnChart'
},

"tipo_post": {
  label: "Facebook anual. Por tipo de publicaci√≥n",
  query: `
    SELECT I, J, K, L
    WHERE I IS NOT NULL
      AND (J IS NOT NULL OR K IS NOT NULL OR L IS NOT NULL)
    LABEL I "A√±o"
  `,
  chartType: 'ColumnChart'
},

"Top_Anual": {
  label: "Top publicaciones anuales",
  query: `
    SELECT T, U, V, W, X, Z
    WHERE T IS NOT NULL
      AND (U IS NOT NULL OR V IS NOT NULL OR W IS NOT NULL OR X IS NOT NULL OR Z IS NOT NULL)
    LABEL T "Top"
  `,
  chartType: 'Card',
  cardTemplate: 'topAnual'
},

"Top_Bimestral": {
  label: "Top publicaciones Bimestrales",
  query: `
    SELECT AB, AC, AE, AF, AH, AI, AK
    WHERE AB IS NOT NULL
      AND (AC IS NOT NULL OR AE IS NOT NULL OR AF IS NOT NULL OR AH IS NOT NULL OR AI IS NOT NULL OR AK IS NOT NULL)
    LABEL AB "Bimestre"
  `,
  chartType: 'Card',
  cardTemplate: 'topBimestral'
}

  },
  "X": {
  "anual": {
  label: "Tasa de compromiso total",
  query: `
    SELECT A, B, C, D, E, F, G, H
    WHERE A IS NOT NULL
      AND (B IS NOT NULL OR C IS NOT NULL OR D IS NOT NULL)
    LABEL
      A "A√±o",
      B "Serie 1",
      C "Serie 2",
      D "Serie 3",
      E "Media Interacciones",
      F "Media Likes",
      G "Media Comentarios",
      H "Media Visualizaciones"
  `,
  chartType: 'ColumnChart',
  chartColumns: [0, 1, 2, 3], // A‚ÄìD ‚Üí gr√°fico
  auxColumns: [4, 5, 6, 7]    // E‚ÄìF‚ÄìG‚ÄìH ‚Üí tarjetas auxiliares
},
"bimestral": {
  label: "Tasa de compromiso por bimestres",
  query: `
    SELECT N, O, P, Q, R, S, T
    WHERE N IS NOT NULL
      AND (O IS NOT NULL OR P IS NOT NULL OR Q IS NOT NULL OR R IS NOT NULL OR S IS NOT NULL OR T IS NOT NULL)
    LABEL N 'Bimestre'
  `,
  chartType: 'ColumnChart'
},
"bimestres_tipo_2025": {
  label: "2025: TC por bimestres y tipo",
  query: `
    SELECT V, W, X
    WHERE V IS NOT NULL
      AND (W IS NOT NULL OR X IS NOT NULL)
    LABEL V 'Bimestre'
  `,
  chartType: 'ColumnChart'
},
"tipo_por_anio": {
  label: "TC por a√±o y tipo",
  query: `
    SELECT J, K, L
    WHERE J IS NOT NULL
      AND (K IS NOT NULL OR L IS NOT NULL)
    LABEL J 'A√±o'
  `,
  chartType: 'ColumnChart'
},
"Top_Anual": {
  label: "Top publicaciones anuales",
  query: `
    SELECT AA, AB, AC, AD, AE, AG
    WHERE AA IS NOT NULL
      AND (AB IS NOT NULL OR AC IS NOT NULL OR AD IS NOT NULL OR AE IS NOT NULL OR AG IS NOT NULL)
    LABEL AA "Top"
  `,
  chartType: 'Card',
  cardTemplate: 'topAnual'
},
"Top_Bimestral": {
  label: "Top publicaciones Bimestrales",
  query: `
    SELECT AH, AI, AK, AL, AN, AO, AQ
    WHERE AH IS NOT NULL
      AND (AI IS NOT NULL OR AK IS NOT NULL OR AL IS NOT NULL OR AN IS NOT NULL OR AO IS NOT NULL OR AQ IS NOT NULL)
    LABEL AH "Bimestre"
  `,
  chartType: 'Card',
  cardTemplate: 'topBimestral'
}
  },
  "TikTok": {
   "anual": {
  label: "Tasa de compromiso total",
  query: `
    SELECT A, B, C, D, E, F, G, H
    WHERE A IS NOT NULL
      AND (B IS NOT NULL OR C IS NOT NULL OR D IS NOT NULL)
    LABEL
      A "A√±o",
      B "Serie 1",
      C "Serie 2",
      D "Serie 3",
      E "Media Interacciones",
      F "Media Likes",
      G "Media Comentarios",
      H "Media Visualizaciones"
  `,
  chartType: 'ColumnChart',
  chartColumns: [0, 1, 2, 3], // A‚ÄìD ‚Üí gr√°fico
  auxColumns: [4, 5, 6, 7]    // E‚ÄìF‚ÄìG‚ÄìH ‚Üí tarjetas auxiliares
},
"bimestral": {
  label: "Tasa de compromiso. Visualizaciones. Bimestral",
  query: `
    SELECT O, P, Q, R, S, T, U
    WHERE O IS NOT NULL
      AND (P IS NOT NULL OR Q IS NOT NULL OR R IS NOT NULL OR S IS NOT NULL OR T IS NOT NULL OR U IS NOT NULL)
    LABEL O 'Bimestre'
  `,
  chartType: 'ColumnChart'
},
"bimestres_tipo": {
  label: "Tasa de compromiso. Por bimestres",
  query: `
    SELECT W, X, Y, Z
    WHERE W IS NOT NULL
      AND (X IS NOT NULL OR Y IS NOT NULL OR Z IS NOT NULL)
    LABEL W 'Bimestre'
  `,
  chartType: 'ColumnChart'
},
"tipo_x_anio": {
  label: "Anual. Por tipo de publicaci√≥n",
  query: `
    SELECT J, K, L, M
    WHERE J IS NOT NULL
      AND (K IS NOT NULL OR L IS NOT NULL OR M IS NOT NULL)
    LABEL J 'A√±o'
  `,
  chartType: 'ColumnChart'
},
"Top_Anual": {
  label: "Top publicaciones anuales",
  query: `
    SELECT AB, AC, AD, AE, AF, AH
    WHERE AB IS NOT NULL
      AND (AC IS NOT NULL OR AD IS NOT NULL OR AE IS NOT NULL OR AF IS NOT NULL OR AH IS NOT NULL)
    LABEL AB "Top"
  `,
  chartType: 'Card',
  cardTemplate: 'topAnual'
}, 
"Top_Bimestral": {
  label: "Top publicaciones Bimestrales",
  query: `
    SELECT AI, AJ, AL, AM, AO, AP, AR
    WHERE AI IS NOT NULL
      AND (AJ IS NOT NULL OR AL IS NOT NULL OR AM IS NOT NULL OR AO IS NOT NULL OR AP IS NOT NULL OR AR IS NOT NULL)
    LABEL AI "Bimestre"
  `,
  chartType: 'Card',
  cardTemplate: 'topBimestral'
}
  },
  "YouTube": {
   "anual": {
  label: "Tasa de compromiso total",
  query: `
    SELECT A, B, C, D, E, F, G
    WHERE A IS NOT NULL
      AND (B IS NOT NULL OR C IS NOT NULL)
    LABEL
      A "A√±o",
      B "Serie 1",
      C "Serie 2",
      D "Media Interacciones",
      E "Media Likes",
      F "Media Comentarios",
      G "Media Visualizaciones"
  `,
  chartType: 'ColumnChart',
  chartColumns: [0, 1, 2], // A‚ÄìD ‚Üí gr√°fico
  auxColumns: [3, 4, 5, 6]    // E‚ÄìF‚ÄìG‚ÄìH ‚Üí tarjetas auxiliares
},
"bimestral": {
  label: "Tasa de compromiso total. Por bimestres",
  query: `
    SELECT T, U, V, W, X, Y, Z
    WHERE T IS NOT NULL
      AND (U IS NOT NULL OR V IS NOT NULL OR W IS NOT NULL OR X IS NOT NULL OR Y IS NOT NULL OR Z IS NOT NULL)
    LABEL T 'Bimestre'
  `,
  chartType: 'ColumnChart'
},
"tc_shorts_anual": {
  label: "Tasa de compromiso en SHORTS",
  query: `
    SELECT H, I, J
    WHERE H IS NOT NULL
      AND (I IS NOT NULL OR J IS NOT NULL)
    LABEL H 'A√±o'
  `,
  chartType: 'ColumnChart'
},
"tc_video_anual": {
  label: "Tasa de compromiso en VIDEOS",
  query: `
    SELECT N, O, P
    WHERE N IS NOT NULL
      AND (O IS NOT NULL OR P IS NOT NULL)
    LABEL N 'A√±o'
  `,
  chartType: 'ColumnChart'
},
"tc_shorts_bimestral": {
  label: "Tasa de compromiso en SHORTS. Por bimestres",
  query: `
    SELECT AA, AB, AC, AD, AE, AF, AG
    WHERE AA IS NOT NULL
      AND (AB IS NOT NULL OR AC IS NOT NULL OR AD IS NOT NULL OR AE IS NOT NULL OR AF IS NOT NULL OR AG IS NOT NULL)
    LABEL AA 'Bimestre'
  `,
  chartType: 'ColumnChart'
},
"tipo_x_anio": {
  label: "Tasa de compromiso total por tipo de publicaci√≥n",
  query: `
    SELECT K, L, M
    WHERE K IS NOT NULL
      AND (L IS NOT NULL OR M IS NOT NULL)
    LABEL K 'A√±o'
  `,
  chartType: 'ColumnChart'
},
"tc_2025_bimestres_tipo": {
  label: "Tasa de compromiso 2025. Por bimestres",
  query: `
    SELECT Q, R, S
    WHERE Q IS NOT NULL
      AND (R IS NOT NULL OR S IS NOT NULL)
    LABEL Q 'Bimestre'
  `,
  chartType: 'ColumnChart'
}, 
"Top_Anual": {
  label: "Top publicaciones anuales",
  query: `
    SELECT AI, AJ, AK, AL, AM, AO
    WHERE AI IS NOT NULL
      AND (AJ IS NOT NULL OR AK IS NOT NULL OR AL IS NOT NULL OR AM IS NOT NULL OR AO IS NOT NULL)
    LABEL AI "Top"
  `,
  chartType: 'Card',
  cardTemplate: 'topAnual'
},
"Top_Bimestral": {
  label: "Top publicaciones Bimestrales",
  query: `
    SELECT AP, AQ, AS, AT, AV, AW, AY
    WHERE AP IS NOT NULL
      AND (AQ IS NOT NULL OR AS IS NOT NULL OR AT IS NOT NULL OR AV IS NOT NULL OR AW IS NOT NULL OR AY IS NOT NULL)
    LABEL AP "Bimestre"
  `,
  chartType: 'Card',
  cardTemplate: 'topBimestral'
}
  }
};

/* === colores por series (coincidir con tu paleta) === */
const COLORS = ['#4e73df','#9c27b0','#28a745','#f6c23e','#e74a3b','#fd7e14','#6f42c1','#3b5998','#ff0000','#000000'];

/* ========== Inicializar Google Charts ========== */
google.charts.load('current', {packages:['corechart']});
google.charts.setOnLoadCallback(initUI);

/* ========== UI bootstrap ========== */
function initUI() {
  const socialSelect = document.getElementById('socialSelect');
  const chartSelect = document.getElementById('chartSelect');

  // llenar socialSelect
  Object.keys(SHEETS).forEach(k => {
    const opt = document.createElement('option');
    opt.value = k;
    opt.text = SHEETS[k].label || k;
    socialSelect.appendChild(opt);
  });

  // evento cambios
  socialSelect.addEventListener('change', () => populateChartsFor(socialSelect.value));
  chartSelect.addEventListener('change', () => loadSelectedChart());

  // seleccion por defecto
socialSelect.value = "General";
populateChartsFor("General");
}

/* Llena chartSelect seg√∫n social */
function populateChartsFor(socialKey) {
  const chartSelect = document.getElementById('chartSelect');
  chartSelect.innerHTML = '';

  const charts = CHARTS_BY_SHEET[socialKey] || {};
  Object.keys(charts).forEach(key => {
    const opt = document.createElement('option');
    opt.value = key;
    opt.text = charts[key].label;
    chartSelect.appendChild(opt);
  });

  // set card title and load first chart
  const first = chartSelect.options[0]?.value;
  if (first) chartSelect.value = first;
  document.getElementById('cardTitle').textContent = `${SHEETS[socialKey].label} ‚Äî ${charts[first]?.label || ''}`;
  loadSelectedChart();
}
 document.getElementById('auxCardsContainer').innerHTML = '';
  document.getElementById('chart_area').innerHTML = '';
  document.getElementById('chartInfo').textContent = '';

/* Construye URL de consulta y carga datos */
function loadSelectedChart() {
  const social = document.getElementById('socialSelect').value;
  const chartKey = document.getElementById('chartSelect').value;
  const chartCfg = CHARTS_BY_SHEET[social]?.[chartKey];

  const infoDiv = document.getElementById('chartInfo');
  const chartArea = document.getElementById('chart_area');
  const auxContainer = document.getElementById('auxCardsContainer');

  if (!chartCfg) {
    chartArea.innerHTML = 'No hay configuraci√≥n para este gr√°fico.';
    return;
  }

  document.getElementById('cardTitle').textContent =
    `${SHEETS[social].label} ‚Äî ${chartCfg.label}`;
  infoDiv.textContent = '';
  auxContainer.innerHTML = '';

  const gid = SHEETS[social].gid;
  const url =
    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq` +
    `?gid=${gid}&tqx=out:json&tq=${encodeURIComponent(chartCfg.query)}`;

  chartArea.innerHTML = 'Cargando gr√°fico...';

  fetch(url)
    .then(r => {
      if (!r.ok) throw new Error('HTTP ' + r.status);
      return r.text();
    })
    .then(text => {
      const m = text.match(
        /google\.visualization\.Query\.setResponse\(([\s\S]*?)\);/
      );
      if (!m) throw new Error('No se pudo parsear la respuesta');

      const json = JSON.parse(m[1]);
      if (!json.table || !json.table.cols?.length)
        throw new Error('La hoja no devolvi√≥ columnas');

      // üü¢ TABLA ORIGINAL (completa)
      const originalTable = new google.visualization.DataTable(json.table);

      /* ================== CARD ================== */
      if (chartCfg.chartType === 'Card') {
        window.renderCards(
          originalTable,
          chartCfg.cardTemplate || 'topAnual'
        );
        auxContainer.innerHTML = '';
        return; // ‚õî no contin√∫a con gr√°ficos
      }

      /* ================== GR√ÅFICO ================== */
      let dataTable = originalTable;

      if (Array.isArray(chartCfg.chartColumns)) {
        dataTable = buildChartTable(originalTable, chartCfg.chartColumns);
      }

      // Forzar primera columna como texto
      if (
        dataTable.getNumberOfRows() > 0 &&
        dataTable.getColumnType(0) === 'number'
      ) {
        const forced = new google.visualization.DataTable();
        forced.addColumn('string', dataTable.getColumnLabel(0));
        for (let c = 1; c < dataTable.getNumberOfColumns(); c++) {
          forced.addColumn(
            dataTable.getColumnType(c),
            dataTable.getColumnLabel(c)
          );
        }
        for (let r = 0; r < dataTable.getNumberOfRows(); r++) {
          const row = [String(dataTable.getValue(r, 0))];
          for (let c = 1; c < dataTable.getNumberOfColumns(); c++) {
            row.push(dataTable.getValue(r, c));
          }
          forced.addRow(row);
        }
        dataTable = forced;
      }

      // Annotations
      const annotated = new google.visualization.DataTable();
      annotated.addColumn(
        dataTable.getColumnType(0),
        dataTable.getColumnLabel(0)
      );

      for (let c = 1; c < dataTable.getNumberOfColumns(); c++) {
        const type = dataTable.getColumnType(c);
        annotated.addColumn(type, dataTable.getColumnLabel(c));
        if (type === 'number')
          annotated.addColumn({ type: 'string', role: 'annotation' });
      }

      for (let r = 0; r < dataTable.getNumberOfRows(); r++) {
        const row = [dataTable.getValue(r, 0)];
        for (let c = 1; c < dataTable.getNumberOfColumns(); c++) {
          const v = dataTable.getValue(r, c);
          row.push(v);
          if (dataTable.getColumnType(c) === 'number') {
            row.push(
              v != null && !isNaN(v)
                ? v.toLocaleString('es-ES', { maximumFractionDigits: 2 })
                : ''
            );
          }
        }
        annotated.addRow(row);
      }

      dataTable = annotated;

      const options = buildOptions(
        chartCfg.label,
        dataTable.getNumberOfColumns() - 1
      );

      let chartObj;
      switch (chartCfg.chartType) {
        case 'LineChart':
          chartObj = new google.visualization.LineChart(chartArea);
          break;
        case 'BarChart':
          chartObj = new google.visualization.BarChart(chartArea);
          break;
        default:
          chartObj = new google.visualization.ColumnChart(chartArea);
      }

// üé® COLORES ‚Äì contar solo series reales (ignora annotations)
let seriesCount = 0;
for (let c = 0; c < dataTable.getNumberOfColumns(); c++) {
  if (dataTable.getColumnType(c) === 'number') {
    seriesCount++;
  }
}

options.colors = COLORS.slice(0, seriesCount);


      chartObj.draw(dataTable, options);

   google.visualization.events.addListener(chartObj, 'select', function () {

  const selection = chartObj.getSelection();
  if (!selection.length) return;

  const row = selection[0].row;

  updateAuxCardsByRow(row, originalTable, chartCfg);

});


      /* ================== TARJETAS AUX ================== */
      if (Array.isArray(chartCfg.auxColumns)) {
        renderAuxCardsFromDataTable(originalTable, chartCfg.auxColumns);
      }
    })
    .catch(err => {
      chartArea.innerHTML =
        `<span style="color:#b00;font-weight:700;">Error: ${err.message}</span>`;
      console.error(err);
    });
}



/* Construye options est√©ticos coherentes con tu dashboard */
function buildOptions(title, seriesCount) {
  return {
    title: title,
    titleTextStyle: { color: "#4e73df", fontSize: 18, bold: true },
    chartArea: { left: 70, top: 60, right: 30, bottom: 80, width:'80%', height:'65%' },

    legend: { position: 'bottom', textStyle: { fontSize: 12 } },

    hAxis: {
      textStyle: { fontSize: 12 },
      gridlines: { color: '#eef0f4' }
    },

    vAxis: {
      textStyle: { fontSize: 12 },
      gridlines: { color: '#e3e6f0' }
    },

    animation: { startup: true, duration: 600, easing: 'out' },

    seriesType: 'bars',

    annotations: {
      alwaysOutside: true,
      textStyle: {
        fontSize: 12,
        bold: true,
        //color: '#000'
      }
    }
  };}

function buildChartTable(sourceTable, chartColumns) {
  const dt = new google.visualization.DataTable();

  chartColumns.forEach((colIdx, i) => {
    dt.addColumn(
      sourceTable.getColumnType(colIdx),
      sourceTable.getColumnLabel(colIdx)
    );
  });

  for (let r = 0; r < sourceTable.getNumberOfRows(); r++) {
    const row = chartColumns.map(c => sourceTable.getValue(r, c));
    dt.addRow(row);
  }

  return dt;
}


  /* ================= CARD TEMPLATES ================= */

const CARD_TEMPLATES = {
  topAnual: renderTopAnualCard,
  topBimestral: renderTopBimestralCard
};

window.renderCards = function (dataTable, template) {
  const chartArea = document.getElementById('chart_area');
  const infoDiv = document.getElementById('chartInfo');

  chartArea.innerHTML = '';
  infoDiv.textContent = '';

  if (!dataTable || dataTable.getNumberOfRows() === 0) {
    chartArea.innerHTML = '<div style="color:#b00">No hay datos para mostrar.</div>';
    return;
  }

  const renderFn = CARD_TEMPLATES[template];

  if (!renderFn) {
    chartArea.innerHTML = `<div style="color:#b00">
      Template "${template}" no definido
    </div>`;
    return;
  }

  let html = `<div class="card-grid">`;

  for (let r = 0; r < dataTable.getNumberOfRows(); r++) {
    html += renderFn(dataTable, r);
  }

  html += `</div>`;
  chartArea.innerHTML = html;
};

/* ================= TEMPLATE: TOP ANUAL ================= */

function renderTopAnualCard(dt, r) {
  const rank = r + 1;

  const tc = Number(dt.getValue(r, 1) || 0);
  const views = dt.getValue(r, 2) ?? '-';
  const reactions = dt.getValue(r, 3) ?? '-';
  const comments = dt.getValue(r, 4) ?? '-';

  // Link puede venir como objeto o string
  let link = dt.getValue(r, 5);
  if (link && typeof link === 'object' && link.v) {
    link = link.v;
  }

  const tcText = tc.toLocaleString('es-AR', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });

  return `
    <div class="card card-top">
      <div class="card-rank"> Top ${rank}</div>

      <div class="card-main">
        TC ${tcText}
      </div>

      <div class="card-stats">
        üëÅ Visualizaciones: <strong>${views}</strong><br/>
        üëç Reacciones: <strong>${reactions}</strong><br/>
        üí¨ Comentarios: <strong>${comments}</strong>
      </div>

      ${
        link
          ? `<a href="${link}" target="_blank" class="card-link">üîó Ver publicaci√≥n</a>`
          : `<span style="color:#999">Link no disponible</span>`
      }
    </div>
  `;
}

/* ================= TEMPLATE: TOP 3 BIMESTRAL ================= */

function renderTopBimestralCard(dt, r) {
  const bimestre = dt.getValue(r, 0) ?? '';

  function formatTC(value) {
    return Number(value || 0).toLocaleString('es-AR', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
  }

  function normalizeLink(v) {
    if (!v) return null;
    if (typeof v === 'object' && v.v) return v.v;
    if (typeof v === 'string' && v.startsWith('http')) return v;
    return null;
  }

  const top1 = formatTC(dt.getValue(r, 1));
  const link1 = normalizeLink(dt.getValue(r, 2));

  const top2 = formatTC(dt.getValue(r, 3));
  const link2 = normalizeLink(dt.getValue(r, 4));

  const top3 = formatTC(dt.getValue(r, 5));
  const link3 = normalizeLink(dt.getValue(r, 6));

  return `
    <div class="card card-top">
      <div class="card-rank">${bimestre}</div>

      <div class="card-stats">
       <strong>Top 1:</strong> ${top1}<br/>
        ${link1 ? `<a class="card-link" href="${link1}" target="_blank">üîó Ver publicaci√≥n</a>` : '<span style="color:#999">Link no disponible</span>'}
        <hr/>

      <strong>Top 2:</strong> ${top2}<br/>
        ${link2 ? `<a class="card-link" href="${link2}" target="_blank">üîó Ver publicaci√≥n</a>` : '<span style="color:#999">Link no disponible</span>'}
        <hr/>

       <strong>Top 3:</strong> ${top3}<br/>
        ${link3 ? `<a class="card-link" href="${link3}" target="_blank">üîó Ver publicaci√≥n</a>` : '<span style="color:#999">Link no disponible</span>'}
      </div>
    </div>
  `;
}
function renderAuxCardsFromDataTable(dataTable, auxColumns) {
  const container = document.getElementById('auxCardsContainer');
  container.innerHTML = '';

  if (!Array.isArray(auxColumns) || auxColumns.length === 0) return;

  auxColumns.forEach(colIdx => {
    const label = dataTable.getColumnLabel(colIdx);

    // Tomamos el primer valor v√°lido de la columna
    let value = null;
    for (let r = 0; r < dataTable.getNumberOfRows(); r++) {
      const v = dataTable.getValue(r, colIdx);
      if (v !== null && v !== undefined && v !== '') {
        value = v;
        break;
      }
    }

if (value === null) return; // ‚õî no crear tarjeta vac√≠a

const card = document.createElement('div');
card.className = 'card aux-card';

card.innerHTML = `
  <div class="aux-row">
    <span class="aux-label">${label}</span>
    <span class="aux-value">
      ${
        typeof value === 'number'
          ? value.toLocaleString('es-ES', { maximumFractionDigits: 2 })
          : value
      }
    </span>
  </div>
`;

container.appendChild(card);

  });
}

function renderAuxCardByName(name, value) {
    return `
        <div class="card">
            <div class="card-rank">${name}</div>
            <div class="card-main">${value}</div>
        </div>
    `;
}

function updateAuxCardsByRow(row, dataTable, chartCfg) {

  const container = document.getElementById('auxCardsContainer');
  container.innerHTML = '';

  chartCfg.auxColumns.forEach(colIndex => {

    const label = dataTable.getColumnLabel(colIndex);
    let value = dataTable.getValue(row, colIndex);

    if (value === null) return;

    value = Number(value).toFixed(2); // 2 decimales

    const card = document.createElement('div');
    card.className = 'card aux-card';

    card.innerHTML = `
      <div class="aux-row">
        <span class="aux-label">${label}</span>
        <span class="aux-value">${value}</span>
      </div>
    `;

    container.appendChild(card);
  });
}


</script>
</body>
</html>